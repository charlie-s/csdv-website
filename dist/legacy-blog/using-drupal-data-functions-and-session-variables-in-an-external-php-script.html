<!DOCTYPE html><html class="no-js" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"><title>Using Drupal data, functions, and session variables in an external PHP script | CS Development</title></head><body><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-66512025-1', 'auto');
            ga('send', 'pageview');</script><div class="container"><h1>Using Drupal data, functions, and session variables in an external PHP script</h1>Just a quick post to save anyone else that runs into this. If you've created something like ajax.php to handle some minor requests outside of your primary Drupal install but you need access to things like the $user object or the PHP $_SESSION variables, you can simply bootstrap Drupal at the top of ajax.php as you need:<pre style="color:#000000;background:#ffffff"><span style="color:#5f5035; background:#ffffe8">&lt;?php</span><span style="color:#000000; background:#ffffe8"></span>
<span style="color:#400000; background:#ffffe8">define</span><span style="color:#808030; background:#ffffe8">(</span><span style="color:#0000e6; background:#ffffe8">'DRUPAL_ROOT'</span><span style="color:#808030; background:#ffffe8">,</span><span style="color:#000000; background:#ffffe8"> </span><span style="color:#797997; background:#ffffe8">$_SERVER</span><span style="color:#808030; background:#ffffe8">[</span><span style="color:#0000e6; background:#ffffe8">'DOCUMENT_ROOT'</span><span style="color:#808030; background:#ffffe8">]</span><span style="color:#808030; background:#ffffe8">)</span><span style="color:#800080; background:#ffffe8">;</span><span style="color:#000000; background:#ffffe8"></span>
<span style="color:#797997; background:#ffffe8">$base_url</span><span style="color:#000000; background:#ffffe8"> </span><span style="color:#808030; background:#ffffe8">=</span><span style="color:#000000; background:#ffffe8"> </span><span style="color:#0000e6; background:#ffffe8">'http://'</span><span style="color:#808030; background:#ffffe8">.</span><span style="color:#797997; background:#ffffe8">$_SERVER</span><span style="color:#808030; background:#ffffe8">[</span><span style="color:#0000e6; background:#ffffe8">'HTTP_HOST'</span><span style="color:#808030; background:#ffffe8">]</span><span style="color:#800080; background:#ffffe8">;</span><span style="color:#000000; background:#ffffe8"></span>
<span style="color:#800000; background:#ffffe8; font-weight:bold">require_once</span><span style="color:#000000; background:#ffffe8"> DRUPAL_ROOT </span><span style="color:#808030; background:#ffffe8">.</span><span style="color:#000000; background:#ffffe8"> </span><span style="color:#0000e6; background:#ffffe8">'/includes/bootstrap.inc'</span><span style="color:#800080; background:#ffffe8">;</span><span style="color:#000000; background:#ffffe8"></span>
<span style="color:#000000; background:#ffffe8">drupal_bootstrap</span><span style="color:#808030; background:#ffffe8">(</span><span style="color:#000000; background:#ffffe8">DRUPAL_BOOTSTRAP_SESSION</span><span style="color:#808030; background:#ffffe8">)</span><span style="color:#800080; background:#ffffe8">;</span><span style="color:#000000; background:#ffffe8"></span>
<span style="color:#5f5035; background:#ffffe8">?></span>
</pre>This is really quite simple. We're definine the path to "DRUPAL_ROOT" which is used throughout bootstrap.inc. Then we're defining the $base_url which will be used by Drupal to make sure we're on the same domain. Finally, we load bootstrap.inc and run drupal_bootstrap() to whatever level we need. Some options are:<ul><li>DRUPAL_BOOTSTRAP_FULL will give you everything; the $user object, $_SESSION variables, you could even run <code>print drupal_render(node_view(node_load(123))) to print out a rendered node.</code></li><li>DRUPAL_BOOTSTRAP_DATABASE will give you full access to the database abstraction layer.</li><li>DRUPAL_BOOTSTRAP_SESSION will allow your PHP $_SESSION variables to use Drupal's session handler, thus passing variables between the two.</li></ul></div><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script><script>if ('addEventListener' in document) {
            document.addEventListener('DOMContentLoaded', function() {
                FastClick.attach(document.body);
            }, false);
        }</script></body></html>